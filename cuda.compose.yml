services:
  app:
    build:
      context: .
      dockerfile: cuda.Dockerfile
      platforms: 
        - linux/amd64
    image: "transcription-bot:cuda"
    platform: linux/amd64
    volumes:
      - ../storage:/app/storage
      - models:/models
    env_file: "compose.env"
    command: "npm run start"
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    develop:
      watch:
        - action: sync
          path: .
          target: /app
volumes:
  models:
    external: true
